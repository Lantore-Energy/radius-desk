# Part 1
 If using 'sudo' produces error, Install sudo

```
apt install sudo
```
<!-- Password:temitope; name:lantore -->

```
# Add the system user
sudo adduser system
# There will be prompt to enter some info - password and fullname - anything is fine. you can press enter to skip it.
# Update the system to the latest
usermod -aG sudo system
# Get the latest package lists
sudo apt-get update
# Update the system to the latest
sudo apt-get upgrade
# Ensure the English language pack is installed
sudo apt-get -y install language-pack-en-base
# Install Nginx
sudo apt-get -y install nginx
# Ensure the web server starts up and is running
apt-get install --reinstall systemd
sudo systemctl enable nginx
service nginx start
```

> Install and Configure PHP-FPM to allow Nginx interpret .php files

```
sudo apt-get -y install php-fpm
# Input Africa in Geographic area 
# Input Lagos in Time zone
sudo systemctl enable php8.1-fpm
service php8.1-fpm start
sudo apt-get install lsof
```


# Modify Nginx to use PHP-FPM

Open this file : /etc/nginx/sites-available/default
Replace the content with the below content

```
server {
	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.php index.html index.htm index.nginx-debian.html;

	server_name _;

	location /cake4/rd_cake/node-reports/submit_report.json {
    	try_files $uri $uri/ /reporting/reporting.php;
    }

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}

	# pass PHP scripts to FastCGI server
	#
	location ~ \.php$ {
		include snippets/fastcgi-php.conf;
	
		# With php-fpm (or other unix sockets):
		fastcgi_pass unix:/run/php/php8.1-fpm.sock;
		# With php-cgi (or other tcp sockets):
		# fastcgi_pass 127.0.0.1:9000;
	}

	location ~ ^/cake4/.+\.(jpg|jpeg|gif|png|ico|js|css)$ {
    	rewrite ^/cake4/rd_cake/webroot/(.*)$ /cake4/rd_cake/webroot/$1 break;
    	rewrite ^/cake4/rd_cake/(.*)$ /cake4/rd_cake/webroot/$1 break;
    	access_log off;
    	expires max;
    	add_header Cache-Control public;
	}

	location /cake4/rd_cake {
   		rewrite ^/cake4/rd_cake(.+)$ /cake4/rd_cake/webroot$1 break;
   		try_files $uri $uri/ /cake4/rd_cake/index.php$is_args$args;
	}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	location ~ /\.ht {
		deny all;
	}
}
```

# Reload Nginx

```
sudo service nginx reload
```

# Create an info.php file and confirm that it interprets PHP properly in this location /var/www/html/info.php

```
# Content
 <?php phpinfo(); ?>
```

Navigate to http://127.0.0.1/info.php and see if the page displays the PHP info.

# Install MariaDB

```
sudo apt-get -y install mariadb-server php-mysql
sudo systemctl enable mariadb
sudo service mariadb restart
sudo service mariadb status
```


# Disable strict mode

Edit this file /etc/mysql/conf.d/disable_strict_mode.cnf, if file does not exist, create it and input the content below

```
[mysqld]
sql_mode=IGNORE_SPACE,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
```

save file  and run the script below to restart

```
sudo service mariadb restart
```




# PART 2


```
sudo apt-get -y install php-cli php-mysql php-gd php-curl php-xml php-mbstring php-intl git wget

cd /var/www
sudo git clone https://github.com/RADIUSdesk/rdcore.git
cd html
sudo ln -s ../rdcore/rd ./rd
sudo ln -s ../rdcore/cake4 ./cake4
sudo ln -s ../rdcore/login ./login
sudo ln -s ../rdcore/AmpConf/build/production/AmpConf ./conf_dev
sudo ln -s ../rdcore/login/rd_client/build/production/AmpConf ./usage
sudo ln -s ../rdcore/cake4/rd_cake/setup/scripts/reporting ./reporting
```


# Change Ownerships

```
# For CakePHP3
sudo mkdir -p  /var/www/html/cake4/rd_cake/logs
sudo mkdir -p /var/www/html/cake4/rd_cake/webroot/files/imagecache
sudo mkdir -p /var/www/html/cake4/rd_cake/tmp
sudo chown -R www-data. /var/www/html/cake4/rd_cake/tmp
sudo chown -R www-data. /var/www/html/cake4/rd_cake/logs
sudo chown -R www-data. /var/www/html/cake4/rd_cake/webroot/img/realms
sudo chown -R www-data. /var/www/html/cake4/rd_cake/webroot/img/dynamic_details
sudo chown -R www-data. /var/www/html/cake4/rd_cake/webroot/img/dynamic_photos
sudo chown -R www-data. /var/www/html/cake4/rd_cake/webroot/img/access_providers
sudo chown -R www-data. /var/www/html/cake4/rd_cake/webroot/img/hardwares
sudo chown -R www-data. /var/www/html/cake4/rd_cake/webroot/files/imagecache
```

# The Database setup

```
sudo su
mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root  mysql

mysql -u root
CREATE DATABASE rd;
GRANT ALL PRIVILEGES ON rd.* to 'rd'@'127.0.0.1' IDENTIFIED BY 'rd';
GRANT ALL PRIVILEGES ON rd.* to 'rd'@'localhost' IDENTIFIED BY 'rd';
FLUSH PRIVILEGES;
exit;

sudo mysql -u root rd < /var/www/html/cake4/rd_cake/setup/db/rd.sql


sudo cp -R /var/www/html/rd/build/production/Rd/* /var/www/html/


sudo cp /var/www/html/cake4/rd_cake/setup/cron/cron4 /etc/cron.d/


sudo apt-get update
sudo apt-get -y install software-properties-common
sudo apt install certbot python3-certbot-nginx
sudo apt-get install ufw
sudo ufw allow 'Nginx Full'
sudo ufw delete allow 'Nginx HTTP'
```




# PART 3

```
sudo apt-get -y install libdatetime-perl
sudo apt-get -y install freeradius freeradius-mysql
sudo systemctl enable freeradius
sudo service freeradius start
```

# Configuration

```
sudo service freeradius stop
sudo mv /etc/freeradius /etc/freeradius.orig
sudo tar xzf /var/www/rdcore/cake4/rd_cake/setup/radius/freeradius-3-radiusdesk.tar.gz --one-top-level=/etc/freeradius/
sudo mv /etc/freeradius/freeradius /etc/freeradius/3.0
sudo chown -R freerad. /etc/freeradius/3.0/
sudo  mkdir /var/run/freeradius
chown freerad. /var/run/freeradius

```


Edit this file /etc/freeradius/3.0/sites-enabled/dynamic-clients
Replace the content with the below content


```
#Define a client that has a 'catch all'
client dymamic {
        ipaddr = 0.0.0.0/0
	#netmask = 0
        #We spacify the virtual server that will be used for client verification
        dynamic_clients = dynamic_clients
        lifetime = 3600
}


server dynamic_clients {

	authorize {

		if ("%{sql: SELECT nasname FROM nas WHERE nasname = '%{Packet-Src-IP-Address}'}") {
			update control {
				FreeRADIUS-Client-IP-Address = "%{Packet-Src-IP-Address}"
				FreeRADIUS-Client-Shortname = "%{sql: SELECT shortname FROM nas WHERE nasname = '%{Packet-Src-IP-Address}'}"
				FreeRADIUS-Client-Secret = "%{sql: SELECT secret FROM nas WHERE nasname = '%{Packet-Src-IP-Address}'}"
				FreeRADIUS-Client-NAS-Type = "%{sql: SELECT type FROM nas WHERE nasname = '%{Packet-Src-IP-Address}'}"
				FreeRADIUS-Client-Require-MA = no
			}
    		}
		else{
			update control {
				#
				#  Echo the IP address of the client.
				FreeRADIUS-Client-IP-Address = "%{Packet-Src-IP-Address}"

				# require_message_authenticator
				FreeRADIUS-Client-Require-MA = no

				# secret
				FreeRADIUS-Client-Secret = "Apo;34-PO54."

				# shortname
				FreeRADIUS-Client-Shortname = "%{Packet-Src-IP-Address}"

				# nas_type
				FreeRADIUS-Client-NAS-Type = "other"

				FreeRADIUS-Client-Virtual-Server = "radiusdesk-plain"

			}
		}
		ok
	}
}

```


Edit this file /lib/systemd/system/freeradius.service
Replace the content with the below content

```
[Unit]
Description=FreeRADIUS multi-protocol policy server
After=network-online.target
Documentation=man:radiusd(8) man:radiusd.conf(5) http://wiki.freeradius.org/ http://networkradius.com/doc/

[Service]
Type=notify
WatchdogSec=60
NotifyAccess=all
#EnvironmentFile=-/etc/default/freeradius

# FreeRADIUS can do static evaluation of policy language rules based
# on environmental variables which is very useful for doing per-host
# customization.
# Unfortunately systemd does not allow variable substitutions such
# as %H or $(hostname) in the EnvironmentFile.
# We provide HOSTNAME here for convenience.
Environment=HOSTNAME=%H

# Limit memory to 2G this is fine for %99.99 of deployments.  FreeRADIUS
# is not memory hungry, if it's using more than this, then there's probably
# a leak somewhere.
MemoryLimit=2G

# Ensure the daemon can still write its pidfile after it drops
# privileges. Combination of options that work on a variety of
# systems. Test very carefully if you alter these lines.
RuntimeDirectory=freeradius
RuntimeDirectoryMode=0775
User=freerad
Group=freerad

#ExecStartPre=/usr/sbin/freeradius $FREERADIUS_OPTIONS -Cx -lstdout
ExecStart=/usr/sbin/freeradius -f $FREERADIUS_OPTIONS
Restart=on-failure
RestartSec=5
ExecReload=/usr/sbin/freeradius $FREERADIUS_OPTIONS -Cxm -lstdout
ExecReload=/bin/kill -HUP $MAINPID

#  Don't elevate privileges after starting
NoNewPrivileges=true

# Allow binding to secure ports, broadcast addresses, and raw interfaces.
#AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_BROADCAST CAP_NET_RAW CAP_SETUID CAP_SETGID CAP_CHOWN CAP_DAC_OVERRIDE

# Private /tmp that isn't shared by other processes
PrivateTmp=true

# cgroups are readable only by radiusd, and child processes
ProtectControlGroups=true

# don't load new kernel modules
ProtectKernelModules=true

# don't tune kernel parameters
ProtectKernelTunables=true

# Only allow native system calls
SystemCallArchitectures=native

# We shouldn't be writing to the configuration directory
ReadOnlyDirectories=/etc/freeradius/

# We can read and write to the log directory.
ReadWriteDirectories=/var/log/freeradius/

[Install]
WantedBy=multi-user.target
```


> Start service

```
sudo systemctl daemon-reload 
sudo service freeradius restart
sudo service freeradius status
```

Create a file called /usr/lib/tmpfiles.d/freeradius.conf

Content
```
d /run/freeradius 750 freerad freerad -
```


# Part 4
Edit this file /etc/sudoers
- Add the following at the bottom
```
%admin ALL=(ALL) ALL www-data ALL = NOPASSWD:/var/www/html/cake4/rd_cake/setup/scripts/radmin_wrapper.pl 
```

> Username: root Password: admin



